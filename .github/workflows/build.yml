name: Build Flutter APK

on:
  workflow_dispatch:  # –¢–æ–ª—å–∫–æ –ø–æ –∫–Ω–æ–ø–∫–µ Run workflow

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥
    - name: üì• Checkout code
      uses: actions/checkout@v4
      
    # 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Flutter
    - name: ‚öôÔ∏è Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.16.9'
        
    # 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - name: üì¶ Get packages
      run: |
        echo "=== –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô ==="
        flutter pub get
        echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
        
    # 4. –û–ß–ò–°–¢–ò–¢–¨ –∫–µ—à (–í–ê–ñ–ù–û!)
    - name: üßπ Clean build cache
      run: |
        echo "=== –û–ß–ò–°–¢–ö–ê –ö–ï–®–ê ==="
        flutter clean
        rm -rf build/
        echo "‚úÖ –ö–µ—à –æ—á–∏—â–µ–Ω"
        
    # 5. –°–æ–±—Ä–∞—Ç—å APK
    - name: üî® Build APK
      run: |
        echo "=== –ù–ê–ß–ê–õ–û –°–ë–û–†–ö–ò –ù–û–í–û–ô –í–ï–†–°–ò–ò ==="
        echo "–î–∞—Ç–∞: $(date)"
        echo "–•—ç—à: ${{ github.sha }}"
        flutter build apk --release --no-tree-shake-icons
        echo "‚úÖ APK –°–û–ë–†–ê–ù!"
        
    # 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–±—Ä–∞–ª–æ—Å—å
    - name: üîç Verify APK
      run: |
        echo "=== –ü–†–û–í–ï–†–ö–ê –§–ê–ô–õ–ê ==="
        ls -la build/app/outputs/flutter-apk/
        echo "üì± –†–∞–∑–º–µ—Ä APK:"
        du -h build/app/outputs/flutter-apk/app-release.apk
        
    # 7. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç —Å –ù–û–í–´–ú –∏–º–µ–Ω–µ–º
    - name: ‚¨ÜÔ∏è Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: NEW-APP-VERSION-$(date +%Y%m%d-%H%M%S)  # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
        path: build/app/outputs/flutter-apk/app-release.apk
